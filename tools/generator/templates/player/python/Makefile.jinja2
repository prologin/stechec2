# SPDX-License-Identifier: GPL-2.0-or-later
# Copyright (c) 2020 Association Prologin <association@prologin.org>
{% import 'macros/make.jinja2' as make %}

# Add all your sources (must be suffixed by *.py) in here, separated by spaces
CHAMPION_SOURCES = champion.py

# ----
# Do not modify the lines below

CHAMPION_SOURCES += api.py
INTERFACE_SOURCES = interface.cc
SOURCES = $(INTERFACE_SOURCES)

{{ make.common_flags() }}

# Use python3-config --embed if it works (>3.8), python3-config otherwise.
py_config = $(shell python3-config --embed >/dev/null && echo python3-config --embed || echo python3-config )
CXXFLAGS += $(shell $(py_config) --includes)
LDFLAGS += $(shell $(py_config) --ldflags)

objs = $(INTERFACE_SOURCES:.cc=.o)
deps = $(objs:.o=.d)

champion.so: $(objs)
	$(CXX) -o $@ $^ -shared $(LDFLAGS)

{{ make.common_rules('python') }}
