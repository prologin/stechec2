# SPDX-License-Identifier: GPL-2.0-or-later
# Copyright (c) 2020 Association Prologin <association@prologin.org>

# Add all your sources (must be suffixed by *.cc) in here, separated by spaces
CHAMPION_SOURCES = champion.c
# Add all other files, like your headers in here, separated by spaces
CHAMPION_HEADERS =

# ----
# Do not modify the lines below

CHAMPION_SOURCES += interface.cc
CHAMPION_HEADERS += api.h

CXXFLAGS = -ggdb3 -Wall -Wextra -std=c99 -fPIC

# TODO
objs = $(CHAMPION_SOURCES:.cc=.o)
deps = $(CHAMPION_SOURCES:.cc=.d)

champion.so: $(objs)
	$(CXX) -o $@ $^ -shared

%.o: %.cc
	$(CXX) $(CXXFLAGS) -MMD -MP -c $< -o $@

clean:
	@$(RM) _lang # In case the tar rule was interrupted
	$(RM) $(objs) $(deps)

distclean: clean
	$(RM) champion.so champion.tgz

champion.tgz: $(CHAMPION_SOURCES) $(CHAMPION_HEADERS)
	@echo "cxx" > _lang
	tar czf $@ $^ _lang
	@rm _lang

tar: champion.tgz

.PHONY: tar clean distclean

-include $(deps)

