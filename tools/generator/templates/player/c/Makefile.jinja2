# SPDX-License-Identifier: GPL-2.0-or-later
# Copyright (c) 2020 Association Prologin <association@prologin.org>

# Add all your sources (must be suffixed by *.cc) in here, separated by spaces
CHAMPION_SOURCES = champion.c
# Add all other files, like your headers in here, separated by spaces
CHAMPION_HEADERS =

# ----
# Do not modify the lines below

INTERFACE_SOURCES = interface.cc
INTERFACE_HEADERS = api.hh

CPPFLAGS = -MMD -MP
CXXFLAGS = -ggdb3 -Wall -std=c++17 -fPIC

objs = $(CHAMPION_SOURCES:.c=.o) $(INTERFACE_SOURCES:.cc=.o)
deps = $(objs:.o=.d)

champion.so: $(objs)
	$(CXX) -o $@ $^ -shared

clean:
	@$(RM) _lang # In case the tar rule was interrupted
	$(RM) $(objs) $(deps)

distclean: clean
	$(RM) champion.so champion.tgz

champion.tgz: $(CHAMPION_SOURCES) $(CHAMPION_HEADERS) $(INTERFACE_SOURCE) $(INTERFACE_HEADERS)
	@echo "c" > _lang
	tar czf $@ $^ _lang
	@rm _lang

tar: champion.tgz

.PHONY: tar clean distclean

-include $(deps)
