# SPDX-License-Identifier: GPL-2.0-or-later
# Copyright (c) 2020 Association Prologin <association@prologin.org>

CHAMPION_SOURCES = champion.cc # Add other sources (*.cc) seperated by spaces
CHAMPION_HEADERS = # Add any additional headers separated by spaces

# ----
# Do not modify the lines below

CHAMPION_SOURCES += interface_cxx.cc
CHAMPION_HEADERS += api.hh

CXXFLAGS = -ggdb3 -Wall -std=c++17 -fPIC

objs = $(CHAMPION_SOURCES:.cc=.o)
deps = $(CHAMPION_SOURCES:.cc=.d)

champion.so: $(objs)
	$(CXX) -o $@ $^ -shared

%.o: %.cc
	$(CXX) $(CXXFLAGS) -MMD -MP -c $< -o $@

clean:
	@$(RM) _lang # In case the tar rule was interrupted
	$(RM) $(objs) $(deps)

distclean: clean
	$(RM) champion.so champion.tgz

champion.tgz: $(CHAMPION_SOURCES) $(CHAMPION_HEADERS)
	@echo "cxx" > _lang
	tar czf $@ $^ _lang
	@rm _lang

tar: champion.tgz

.PHONY: tar clean distclean

-include $(deps)

